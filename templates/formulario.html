<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Inscrição de Aluno</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">
<div class="container py-5">
  <div class="col-lg-10 mx-auto bg-white p-4 shadow-sm rounded-3">
    <h2 class="mb-4 text-center">Formulário de Inscrição – Época 2025/2026</h2>

    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        {% for category, msg in messages %}
          <div class="alert alert-{{category}}">{{ msg }}</div>
        {% endfor %}
      {% endif %}
    {% endwith %}

    <form method="post" novalidate>
      <!-- Nome -->
      <div class="mb-3">
        <label class="form-label" for="nome">Nome completo</label>
        <input type="text" name="nome" id="nome" class="form-control" required />
      </div>

      <!-- Email -->
      <div class="mb-3">
        <label class="form-label" for="email">Email</label>
        <input type="email" name="email" id="email" class="form-control" required />
      </div>

      <!-- Contacto -->
      <div class="mb-3">
        <label class="form-label" for="contacto">Contacto (telemóvel)</label>
        <input type="tel" name="contacto" id="contacto" class="form-control" required />
      </div>

      <!-- Treinos / semana -->
      <div class="mb-3">
        <label class="form-label" for="treinos_semana">Número de treinos por semana</label>
        <select name="treinos_semana" id="treinos_semana" class="form-select" required>
          <option disabled selected value="">Seleciona o nº de treinos por semana</option>
          <option value="1">1</option>
          <option value="2">2</option>
          <option value="3">3</option>
          <option value="4">4</option>
        </select>
      </div>

      <!-- Tipo de treino -->
      <div class="mb-4">
        <label class="form-label">Opções de treino e mensalidades</label>
        <div class="table-responsive mb-3">
          <table class="table table-bordered text-center align-middle">
            <thead class="table-light">
              <tr>
                <th rowspan="2" class="align-middle">Frequência</th>
                <th rowspan="2" class="align-middle">Mensalidade<br>Normal</th>
                <th colspan="2">Mensalidade Competição</th>
              </tr>
              <tr>
                <th>c/ The Code</th>
                <th>s/ The Code</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>1x por semana (Peak)</td>
                <td>66€</td>
                <td>129€</td>
                <td>101€</td>
              </tr>
              <tr>
                <td>1x por semana (Off Peak)</td>
                <td>58€</td>
                <td>116€</td>
                <td>91€</td>
              </tr>
              <tr>
                <td>2x por semana (Peak)</td>
                <td>119€</td>
                <td>200€</td>
                <td>175€</td>
              </tr>
              <tr>
                <td>2x por semana (Off Peak)</td>
                <td>103€</td>
                <td>188€</td>
                <td>163€</td>
              </tr>
              <tr style="background-color: #f9f9f9;">
                <td>1x normal + 1x competição (c/ The Code)</td>
                <td colspan="3">175,50€</td>
              </tr>
              <tr style="background-color: #f9f9f9;">
                <td>1x normal + 1x competição (s/ The Code)</td>
                <td colspan="3">50,30€</td>
              </tr>
            </tbody>
          </table>
        </div>

        <div class="small text-muted mb-2 text-start">
          Todas as turmas são compostas por 4 participantes.<br>
          <strong>Peak</strong>: a partir das 17h | <strong>Off Peak</strong>: até às 17h.<br>
          Aulas de <strong>competição</strong> têm duração de <strong>1h30</strong> e são indicadas para alunos que participam (ou querem participar) em torneios e Liga de Clubes.<br>
          Aulas <strong>normais</strong> têm duração de <strong>1h</strong>.
        </div>

        <select name="tipo_treino" id="tipo_treino" class="form-select" required>
          <option disabled selected value="">Seleciona uma opção</option>
          <option value="normal_peak_1x" class="opt-1">1x semana - Normal (Peak - 66€)</option>
          <option value="normal_offpeak_1x" class="opt-1">1x semana - Normal (Off Peak - 58€)</option>
          <option value="normal_peak_2x" class="opt-2">2x semana - Normal (Peak - 119€)</option>
          <option value="normal_offpeak_2x" class="opt-2">2x semana - Normal (Off Peak - 127€)</option>

          <option value="comp_thecode_peak_1x" class="opt-1">1x semana - Competição c/ The Code (Peak - 129€)</option>
          <option value="comp_thecode_offpeak_1x" class="opt-1">1x semana - Competição c/ The Code (Off Peak - 116€)</option>
          <option value="comp_thecode_peak_2x" class="opt-2">2x semana - Competição c/ The Code (Peak - 200€)</option>
          <option value="comp_thecode_offpeak_2x" class="opt-2">2x semana - Competição c/ The Code (Off Peak - 163€)</option>

          <option value="comp_semcode_peak_1x" class="opt-1">1x semana - Competição s/ The Code (Peak - 101€)</option>
          <option value="comp_semcode_offpeak_1x" class="opt-1">1x semana - Competição s/ The Code (Off Peak - 91€)</option>
          <option value="comp_semcode_peak_2x" class="opt-2">2x semana - Competição s/ The Code (Peak - 175€)</option>
          <option value="comp_semcode_offpeak_2x" class="opt-2">2x semana - Competição s/ The Code (Off Peak - 163€)</option>

          <option value="mixed_thecode" class="opt-2">1x normal + 1x competição c/ The Code (Sob consulta)</option>
          <option value="mixed_semcode" class="opt-2">1x normal + 1x competição s/ The Code (Sob consulta)</option>
        </select>
      </div>

      <!-- Género -->
      <div class="mb-3">
        <label class="form-label">Tipo de turma preferido</label>
        <select name="genero_turma" class="form-select" required>
          <option disabled selected value="">Seleciona o tipo de turma</option>
          <option>Masculina</option>
          <option>Feminina</option>
          <option>Mista</option>
          <option>Indiferente</option>
        </select>
      </div>

      <!-- Disponibilidade -->
      <hr class="my-4">
      <h5 class="mb-3">Disponibilidade para treinos</h5>
      <div class="alert alert-info small">
        Indica <strong>todos os horários</strong> em que estás disponível para treinar, para <strong>cada dia da semana</strong>.<br>
        Exemplo: se podes treinar na 2ª feira das 17h às 18h e na 4ª feira das 20h às 21h, adiciona os dois intervalos. 
      </div>

      {% set dias = ['2a','3a','4a','5a','6a'] %}
      <ul class="nav nav-tabs mb-3" id="diaTabs" role="tablist">
        {% for dia in dias %}
        <li class="nav-item" role="presentation">
          <button class="nav-link {% if loop.index0 == 0 %}active{% endif %}"
                  id="tab-{{dia}}"
                  data-bs-toggle="tab"
                  data-bs-target="#pane-{{dia}}"
                  type="button" role="tab">
            {{ dia[:-1] }}ª feira
          </button>
        </li>
        {% endfor %}
      </ul>

      <div class="tab-content">
        {% for dia in dias %}
        <div class="tab-pane fade {% if loop.index0 == 0 %}show active{% endif %}" id="pane-{{dia}}" role="tabpanel">
          <div id="rows-{{dia}}"></div>
          <button type="button" class="btn btn-outline-primary btn-sm mt-2" onclick="addRow('{{dia}}')">
            + Adicionar intervalo neste dia
          </button>
        </div>
        {% endfor %}
      </div>

      <div class="text-center mt-4">
        <div id="form-alert" class="alert alert-danger d-none" role="alert">
          Por favor, preenche todos os campos obrigatórios antes de submeter.
        </div>
        <button type="submit" class="btn btn-success px-5">Submeter</button>
      </div>
    </form>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
  const dias = ['2a','3a','4a','5a','6a'];
  dias.forEach(d => addRow(d));

  function addRow(dia) {
    const container = document.getElementById("rows-" + dia);
    const div = document.createElement("div");
    div.className = "row g-2 align-items-center mb-1";
    div.innerHTML = `
      <div class="col-auto">
        <input type="time" name="${dia}_inicio" class="form-control" step="1800" required>
      </div>
      <div class="col-auto">&#8594;</div>
      <div class="col-auto">
        <input type="time" name="${dia}_fim" class="form-control" step="1800" required>
      </div>
      <div class="col-auto">
        <button type="button" class="btn btn-danger btn-sm" onclick="this.closest('.row').remove()">×</button>
      </div>`;
    container.appendChild(div);
  }

  const treinoInput = document.getElementById("treinos_semana");
  const treinoSelect = document.getElementById("tipo_treino");

  function filtrarOpcoesTreino() {
    const n = parseInt(treinoInput.value) || 0;
    [...treinoSelect.options].forEach(opt => {
      if (opt.value === "") return;
      const mostrar =
        (n === 1 && opt.classList.contains("opt-1")) ||
        (n >= 2 && opt.classList.contains("opt-2"));
      opt.style.display = mostrar ? "block" : "none";
    });

    if (treinoSelect.selectedOptions.length &&
        treinoSelect.selectedOptions[0].style.display === "none") {
      treinoSelect.selectedIndex = 0;
    }
  }

  treinoInput.addEventListener("change", filtrarOpcoesTreino);
  window.addEventListener("DOMContentLoaded", filtrarOpcoesTreino);
</script>
<script>
    const form = document.querySelector("form");
    const alertBox = document.getElementById("form-alert");
  
    form.addEventListener("submit", function (event) {
      alertBox.classList.add("d-none");  // esconder alerta, por defeito
  
      const requiredFields = form.querySelectorAll("[required]");
      let valid = true;
  
      requiredFields.forEach(field => {
        if (!field.value.trim()) {
          valid = false;
        }
      });
  
      if (!valid) {
        event.preventDefault();
        alertBox.classList.remove("d-none");
        alertBox.scrollIntoView({ behavior: "smooth", block: "start" });
      }
    });
</script>
</body>
</html>








